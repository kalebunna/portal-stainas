<div class="login-container">
  <div class="login-card">
    <div class="login-header">
      <svg
        class="login-logo"
        width="60"
        height="60"
        viewBox="0 0 100 100"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <circle cx="50" cy="50" r="40" stroke="#2c6345" stroke-width="8" />
        <path
          d="M35 50L45 60L65 40"
          stroke="#2c6345"
          stroke-width="8"
          stroke-linecap="round"
          stroke-linejoin="round"
        />
      </svg>
      <h1 class="login-title">Admin Dashboard</h1>
      <p class="login-subtitle">Login to access your admin panel</p>
    </div>

    <div class="login-body">
      <div id="loginAlert" class="alert alert-danger d-none" role="alert">
        <i class="bi bi-exclamation-triangle-fill me-2"></i>
        <span id="loginAlertMessage"></span>
      </div>

      <form id="loginForm">
        <div class="mb-4">
          <label for="email" class="form-label">Email</label>
          <div class="input-group">
            <span class="input-group-text"><i class="bi bi-envelope"></i></span>
            <input
              type="email"
              class="form-control"
              id="email"
              placeholder="Enter your email"
              required
            />
          </div>
        </div>

        <div class="mb-4">
          <label for="password" class="form-label">Password</label>
          <div class="input-group">
            <span class="input-group-text"><i class="bi bi-lock"></i></span>
            <input
              type="password"
              class="form-control"
              id="password"
              placeholder="Enter your password"
              required
            />
            <button
              class="btn btn-outline-secondary toggle-password"
              type="button"
              tabindex="-1"
            >
              <i class="bi bi-eye"></i>
            </button>
          </div>
        </div>

        <div class="mb-4 form-check">
          <input type="checkbox" class="form-check-input" id="rememberMe" />
          <label class="form-check-label" for="rememberMe">Remember me</label>
        </div>

        <button type="submit" class="btn btn-primary w-100" id="loginButton">
          <span
            class="spinner-border spinner-border-sm d-none me-2"
            role="status"
            aria-hidden="true"
            id="loginSpinner"
          ></span>
          Sign In
        </button>
      </form>
    </div>

    <div class="login-footer text-center">
      <p>&copy; 2025 AdminDash. All rights reserved.</p>
    </div>
  </div>
</div>

<style>
  .login-container {
    background-color: white;
    padding: 2rem;
    border-radius: 0.5rem;
    box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.1);
    width: 100%;
  }

  .login-card {
    width: 100%;
    max-width: 450px;
    background-color: white;
    border-radius: var(--border-radius-lg);
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    overflow: hidden;
  }

  .login-header {
    padding: 2.5rem 2rem;
    text-align: center;
    background-color: white;
    border-bottom: 1px solid var(--gray-200);
  }

  .login-logo {
    margin-bottom: 1.5rem;
  }

  .login-title {
    font-size: 1.75rem;
    font-weight: 700;
    color: var(--gray-900);
    margin-bottom: 0.5rem;
  }

  .login-subtitle {
    color: var(--gray-600);
    font-size: 0.95rem;
  }

  .login-body {
    padding: 2rem;
  }

  .login-footer {
    padding: 1.5rem;
    background-color: var(--gray-50);
    border-top: 1px solid var(--gray-200);
  }

  .login-footer p {
    color: var(--gray-600);
    font-size: 0.85rem;
    margin-bottom: 0;
  }

  .toggle-password {
    cursor: pointer;
  }

  .shake {
    animation: shake 0.5s cubic-bezier(0.36, 0.07, 0.19, 0.97) both;
  }

  @keyframes shake {
    10%,
    90% {
      transform: translate3d(-1px, 0, 0);
    }
    20%,
    80% {
      transform: translate3d(2px, 0, 0);
    }
    30%,
    50%,
    70% {
      transform: translate3d(-3px, 0, 0);
    }
    40%,
    60% {
      transform: translate3d(3px, 0, 0);
    }
  }
  @media (max-width: 767.98px) {
    body.login-page .app-container {
      padding: 1rem;
    }
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Get form elements
    const loginForm = document.getElementById("loginForm");
    const loginButton = document.getElementById("loginButton");
    const loginSpinner = document.getElementById("loginSpinner");
    const loginAlert = document.getElementById("loginAlert");
    const loginAlertMessage = document.getElementById("loginAlertMessage");
    const emailInput = document.getElementById("email");
    const passwordInput = document.getElementById("password");
    const rememberMeCheckbox = document.getElementById("rememberMe");

    // Handle toggle password visibility
    const togglePasswordBtn = document.querySelector(".toggle-password");
    togglePasswordBtn.addEventListener("click", function () {
      const type =
        passwordInput.getAttribute("type") === "password" ? "text" : "password";
      passwordInput.setAttribute("type", type);
      this.querySelector("i").classList.toggle("bi-eye");
      this.querySelector("i").classList.toggle("bi-eye-slash");
    });

    // Handle form submission
    loginForm.addEventListener("submit", async function (e) {
      e.preventDefault();

      // Show loading state
      loginButton.disabled = true;
      loginSpinner.classList.remove("d-none");
      loginAlert.classList.add("d-none");

      // Get form data
      const email = emailInput.value;
      const password = passwordInput.value;
      const remember = rememberMeCheckbox.checked;

      try {
        // Send login request to Laravel Sanctum
        const response = await fetch("/api/login", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            Accept: "application/json",
            "X-CSRF-TOKEN": getCsrfToken(),
          },
          body: JSON.stringify({ email, password, remember }),
        });

        const data = await response.json();

        if (response.ok) {
          // Store authentication token
          localStorage.setItem("auth_token", data.token);

          // Store user data
          localStorage.setItem("user", JSON.stringify(data.user));
          localStorage.setItem("roles", JSON.stringify(data.roles));
          localStorage.setItem("permissions", JSON.stringify(data.permissions));

          // Redirect to dashboard
          window.location.href = "#dashboard";

          // Show success toast
          if (window.appToast) {
            window.appToast.success(
              "Login successful! Redirecting to dashboard..."
            );
          }
        } else {
          // Show error message
          loginAlert.classList.remove("d-none");
          loginAlertMessage.textContent =
            data.message || "Invalid credentials. Please try again.";

          // Add shake animation
          loginForm.classList.add("shake");
          setTimeout(() => {
            loginForm.classList.remove("shake");
          }, 500);
        }
      } catch (error) {
        console.error("Login error:", error);
        loginAlert.classList.remove("d-none");
        loginAlertMessage.textContent =
          "Network error. Please try again later.";
      } finally {
        // Reset button state
        loginButton.disabled = false;
        loginSpinner.classList.add("d-none");
      }
    });

    // Function to get CSRF token from meta tag
    function getCsrfToken() {
      return (
        document
          .querySelector('meta[name="csrf-token"]')
          ?.getAttribute("content") || ""
      );
    }

    // Check if user is already logged in
    function checkAuthState() {
      const token = localStorage.getItem("auth_token");
      if (token) {
        // Redirect to dashboard if already logged in
        window.location.href = "#dashboard";
      }
    }

    // Check authentication state on page load
    checkAuthState();
  });
</script>
